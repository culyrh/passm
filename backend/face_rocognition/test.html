<!DOCTYPE html>
<html>
<head>
    <title>ì–¼êµ´ ì¸ì‹ ì‹œê°í™” í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial; margin: 50px; }
        .container { max-width: 800px; margin: 0 auto; }
        input[type="file"] { margin: 10px 0; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #result { margin-top: 20px; }
        canvas { border: 2px solid #ddd; margin-top: 10px; }
        .info { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì–¼êµ´ ì¸ì‹ ì‹œê°í™” í…ŒìŠ¤íŠ¸</h1>
        <div class="info">
            <p><strong>ì‚¬ìš©ë²•:</strong></p>
            <p>1. ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
            <p>2. "ì¸ì‹í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
            <p>3. ì°¾ì€ ì–¼êµ´ì— ë°•ìŠ¤ê°€ í‘œì‹œë©ë‹ˆë‹¤ (ì¸ì‹ ì„±ê³µ: ì´ˆë¡ìƒ‰, ì‹¤íŒ¨: ë¹¨ê°„ìƒ‰)</p>
        </div>
        
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="uploadImage()">ì¸ì‹í•˜ê¸°</button>
        
        <div id="result">
            <div id="info"></div>
            <canvas id="canvas" style="display:none;"></canvas>
        </div>
    </div>

    <script>
    function uploadImage() {
        const input = document.getElementById('imageInput');
        const file = input.files[0];
        if (!file) {
            alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        // ë¡œë”© í‘œì‹œ
        document.getElementById('info').innerHTML = 'ğŸ”„ ì–¼êµ´ ì¸ì‹ ì¤‘...';

        fetch('http://localhost:8000/recognize_visual', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.faces_found > 0) {
                displayDetailedResults(data);
                drawFaceBoxes(file, data.face_locations || [], data.detailed_results || []);
            } else {
                document.getElementById('info').innerHTML = 'âŒ ì–¼êµ´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                document.getElementById('canvas').style.display = 'none';
            }
        })
        .catch(error => {
            document.getElementById('info').innerHTML = 'âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error;
        });
    }

    function displayDetailedResults(data) {
        let html = `<h3>${data.faces_found}ê°œì˜ ì–¼êµ´ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!</h3>`;
        
        if (data.detailed_results) {
            data.detailed_results.forEach(result => {
                html += `
                <div style="background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid ${result.recognized ? '#28a745' : '#dc3545'};">
                    <h4>[ì–¼êµ´ ${result.face_number}]</h4>
                    <p><strong>ìƒíƒœ:</strong> ${result.status}</p>
                    <p><strong>ì¸ì‹ê²°ê³¼:</strong> ${result.celebrity || 'ì•Œ ìˆ˜ ì—†ìŒ'}</p>
                    ${result.confidence ? `<p><strong>ì‹ ë¢°ë„:</strong> ${result.confidence}%</p>` : ''}
                    ${result.actual_confidence ? `<p><strong>ì‹¤ì œ ìœ ì‚¬ë„:</strong> ${result.actual_confidence}%</p>` : ''}
                    ${result.best_match ? `<p><strong>ê°€ì¥ ìœ ì‚¬í•œ ì¸ë¬¼:</strong> ${result.best_match}</p>` : ''}
                    <p><strong>ìœ„ì¹˜:</strong> (${result.location.left}, ${result.location.top}) - (${result.location.right}, ${result.location.bottom})</p>
                    <p><strong>í¬ê¸°:</strong> ${result.size.width} Ã— ${result.size.height} pixels (ë©´ì : ${result.size.area})</p>
                    ${result.landmarks ? `<p><strong>ì–¼êµ´ íŠ¹ì§•ì :</strong> ${Object.keys(result.landmarks).length}ê°œ ë¶€ìœ„ ê°ì§€</p>` : ''}
                </div>`;
            });
        }
        
        document.getElementById('info').innerHTML = html;
    }

    function drawFaceBoxes(imageFile, faceLocations, detailedResults = []) {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • (ìµœëŒ€ 800px)
            const maxWidth = 800;
            const scale = Math.min(maxWidth / img.width, maxWidth / img.height, 1);
            
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            canvas.style.display = 'block';
            
            // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            // ì–¼êµ´ ë°•ìŠ¤ì™€ ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸°
            faceLocations.forEach((face, index) => {
                const x = face.left * scale;
                const y = face.top * scale;
                const width = (face.right - face.left) * scale;
                const height = (face.bottom - face.top) * scale;
                
                const result = detailedResults[index];
                const color = result && result.recognized ? '#28a745' : '#dc3545';
                
                // ë°•ìŠ¤ ê·¸ë¦¬ê¸°
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.strokeRect(x, y, width, height);
                
                // ë¼ë²¨ ë°°ê²½
                const label = result ? `${result.celebrity} (${result.confidence || 0}%)` : `ì–¼êµ´ ${index + 1}`;
                ctx.font = '14px Arial';
                const textWidth = ctx.measureText(label).width;
                ctx.fillStyle = color;
                ctx.fillRect(x, y - 25, textWidth + 10, 20);
                
                // ë¼ë²¨ í…ìŠ¤íŠ¸
                ctx.fillStyle = 'white';
                ctx.fillText(label, x + 5, y - 10);
                
                // ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸° (ìˆë‹¤ë©´)
                if (result && result.landmarks) {
                    ctx.fillStyle = '#ffd700';
                    Object.values(result.landmarks).forEach(points => {
                        points.forEach(point => {
                            ctx.beginPath();
                            ctx.arc(point[0] * scale, point[1] * scale, 1, 0, 2 * Math.PI);
                            ctx.fill();
                        });
                    });
                }
            });
        };
        
        img.src = URL.createObjectURL(imageFile);
    }
    </script>
</body>
</html>